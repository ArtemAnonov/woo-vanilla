(()=>{"use strict";function t(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},e(t)}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,o,a){var n=function(t,o){for(;!Object.prototype.hasOwnProperty.call(t,o)&&null!==(t=e(t)););return t}(t,o);if(n){var i=Object.getOwnPropertyDescriptor(n,o);return i.get?i.get.call(arguments.length<3?t:a):i.value}},o.apply(this,arguments)}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!==i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}function c(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,s(a.key),a)}}function u(t,e,o){return e&&c(t.prototype,e),o&&c(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(o){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=e(o);if(a){var s=e(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return function(e,o){if(o&&("object"===i(o)||"function"==typeof o))return o;if(void 0!==o)throw new TypeError("Derived constructors may only return object or undefined");return t(e)}(this,n)}}jQuery(document).ready((function(a){var s="1"==xoo_wsc_params.isCart,c="1"==xoo_wsc_params.isCheckout,l=function(t){return xoo_wsc_params.wc_ajax_url.toString().replace("%%endpoint%%",t)},h=function(){function t(e){r(this,t),this.$modal=e,this.timeout=null}return u(t,[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.$modal.find(".xoo-wsc-notice-container");o&&a.html("");var n="success"===e?xoo_wsc_params.html.successNotice.toString().replace("%s%",t):xoo_wsc_params.html.errorNotice.toString().replace("%s%",t);a.html(n)}},{key:"showNotification",value:function(){var t=this.$modal.find(".xoo-wsc-notice-container");t.length&&0!==t.children().length&&(t.slideDown(),clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.slideUp("slow",(function(){}))}),xoo_wsc_params.notificationTime))}},{key:"hideNotification",value:function(){this.$modal.find(".xoo-wsc-notice-container").hide()}}]),t}(),p=function(){function t(e,o){r(this,t),this.$modal=e,this.container=o||"cart",this.notice=new h(this.$modal)}return u(t,[{key:"eventHandlers",value:function(){a(document.body).on("wc_fragments_refreshed updated_checkout",this.onCartUpdate.bind(this))}},{key:"onCartUpdate",value:function(){this.unblock(),this.notice.showNotification()}},{key:"setAjaxData",value:function(t,e){var o={container:this.container,noticeSection:e||this.noticeSection||this.container,isCheckout:c,isCart:s};if("object"===i(t))a.extend(o,t);else{var n=t;a.each(o,(function(t,e){n+="&"+t+"="+e})),o=n}return o}},{key:"toggle",value:function(t){var e=this.$modal.add("body").add("html"),o="xoo-wsc-"+this.container+"-active";"show"===t?e.addClass(o):"hide"===t?e.removeClass(o):e.toggleClass(o),a(document.body).trigger("xoo_wsc_"+this.container+"_toggled",[t]),this.notice.hideNotification()}},{key:"block",value:function(){this.$modal.addClass("placeholder-wave")}},{key:"unblock",value:function(){this.$modal.removeClass("placeholder-wave")}},{key:"refreshMyFragments",value:function(){"yes"!==xoo_wsc_params.refreshCart||"undefined"==typeof wc_cart_fragments_params?(this.block(),a.ajax({url:l("xoo_wsc_refresh_fragments"),type:"POST",context:this,data:{},success:function(t){this.updateFragments(t)},complete:function(){this.unblock()}})):a(document.body).trigger("wc_fragment_refresh")}},{key:"updateCartCheckoutPage",value:function(){if(c){if(0===a("form.checkout").length)return void location.reload();a(document.body).trigger("update_checkout")}s&&a(document.body).trigger("wc_update_cart")}},{key:"updateFragments",value:function(t){if(t.fragments&&(a(document.body).trigger("xoo_wsc_before_loading_fragments",[t]),this.block(),a.each(t.fragments,(function(t,e){a(t).replaceWith(e)})),"undefined"!=typeof wc_cart_fragments_params&&"sessionStorage"in window&&null!==window.sessionStorage&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(t.fragments)),localStorage.setItem(wc_cart_fragments_params.cart_hash_key,t.cart_hash),sessionStorage.setItem(wc_cart_fragments_params.cart_hash_key,t.cart_hash),t.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime())),a(document.body).trigger("wc_fragments_refreshed"),this.unblock()),"yes"===xoo_wsc_params.refreshCart&&"undefined"!=typeof wc_cart_fragments_params)return this.block(),void a(document.body).trigger("wc_fragment_refresh")}}]),t}(),f=function(t){n(h,t);var i=d(h);function h(t){var e;return r(this,h),(e=i.call(this,t,"cart")).baseQty=1,e.qtyUpdateDelay=null,e.refreshFragmentsOnPageLoad(),e.eventHandlers(),e.initSlider(),e}return u(h,[{key:"refreshFragmentsOnPageLoad",value:function(){setTimeout(function(){this.refreshMyFragments()}.bind(this),xoo_wsc_params.fetchDelay)}},{key:"eventHandlers",value:function(){o(e(h.prototype),"eventHandlers",this).call(this),this.$modal.on("click",".xoo-wsc-chng",this.toggleQty.bind(this)),this.$modal.on("change",".xoo-wsc-qty",this.changeInputQty.bind(this)),this.$modal.on("click",".xoo-wsc-undo-item",this.undoItem.bind(this)),this.$modal.on("focusin",".xoo-wsc-qty",this.saveQtyFocus.bind(this)),this.$modal.on("click",".xoo-wsc-smr-del",this.deleteIconClick.bind(this)),this.$modal.on("click",".xoo-wsch-close, .xoo-wsc-opac, .xoo-wsc-cart-close",this.closeCartOnClick.bind(this)),this.$modal.on("click",".xoo-wsc-basket",this.toggle.bind(this)),a(document.body).on("xoo_wsc_cart_updated",this.updateCartCheckoutPage.bind(this)),a(document.body).on("click","a.added_to_cart, .xoo-wsc-cart-trigger",this.openCart.bind(this)),a(document.body).on("added_to_cart",this.addedToCart.bind(this)),"yes"===xoo_wsc_params.autoOpenCart&&"yes"===xoo_wsc_params.addedToCart&&this.openCart(),"yes"===xoo_wsc_params.ajaxAddToCart&&a(document.body).on("submit","form.cart",this.addToCartFormSubmit.bind(this)),"undefined"==typeof wc_cart_fragments_params&&a(window).on("pageshow",this.onPageShow),(c||s)&&a(document.body).on("updated_shipping_method",this.refreshMyFragments.bind(this)),a(document.body).on("xoo_wsc_before_loading_fragments",this.storeShippingBarWidth.bind(this))}},{key:"openCart",value:function(t){t&&t.preventDefault(),this.toggle("show")}},{key:"addToCartFormSubmit",value:function(t){var e=a(t.currentTarget);if(!e.closest(".product").hasClass("product-type-external")){t.preventDefault();var o=e.find('button[type="submit"]'),n=e.serializeArray(),i=!1;if(a.each(n,(function(t,e){if(("productID"===e.name||"add-to-cart"===e.name)&&e.value)return i=!0,!1})),!i)var r=e.attr("action").match(/add-to-cart=([0-9]+)/),s=!!r&&r[1];if(o.attr("name")&&"add-to-cart"==o.attr("name")&&o.attr("value"))s=o.attr("value");s&&n.push({name:"add-to-cart",value:s}),n.push({name:"action",value:"xoo_wsc_add_to_cart"}),this.addToCartAjax(o,n)}}},{key:"addToCartAjax",value:function(t,e){this.block(),t.addClass("placeholder-wave"),a(document.body).trigger("adding_to_cart",[t,e]),a.ajax({url:l("xoo_wsc_add_to_cart"),type:"POST",context:this,data:a.param(e),success:function(e){e.fragments?a(document.body).trigger("added_to_cart",[e.fragments,e.cart_hash,t]):window.location.reload()},complete:function(){this.unblock(),t.removeClass("placeholder-wave").addClass("added")}})}},{key:"addedToCart",value:function(t,e,o,a){this.updateFragments({fragments:e}),this.onCartUpdate();var n=this;this.flyToCart(a,(function(){"yes"===xoo_wsc_params.autoOpenCart&&setTimeout((function(){n.openCart()}),20)}))}},{key:"flyToCart",value:function(t,e){var o=this.$modal.find(".xoo-wsc-basket").length?this.$modal.find(".xoo-wsc-basket"):a(document.body).find(".xoo-wsc-sc-cont");if(o.length&&"yes"===xoo_wsc_params.flyToCart){var n=null,i=t.parents(".product");if(i.length){var r=i.find(".woocommerce-product-gallery");n=i.find('img[data-xooWscFly="fly"]').length?r.length?r.find('.flex-active-slide img[data-xooWscFly="fly"]').length?r.find('.flex-active-slide img[data-xooWscFly="fly"]'):r.find('img[data-xooWscFly="fly"]'):i.find('img[data-xooWscFly="fly"]'):r.length?r:i}else{}if(n&&n.length){var s=n.clone().offset({top:n.offset().top,left:n.offset().left}).addClass("xoo-wsc-fly-animating").appendTo(a("body")).animate({top:o.offset().top-10,left:o.offset().left-10,width:75,height:75},1e3,"easeInOutExpo");setTimeout((function(){e()}),1500),s.animate({width:0,height:0},(function(){a(this).detach()}))}else e()}else e()}},{key:"toggleQty",value:function(t){var e=a(t.currentTarget),o=e.siblings(".xoo-wsc-qty");if(o.length){var n=this.baseQty=parseFloat(o.val()),i=parseFloat(o.attr("step")),r="add"===(e.hasClass("xoo-wsc-plus")?"add":"less")?n+i:n-i;o.val(r).trigger("change")}}},{key:"changeInputQty",value:function(t){this.notice.hideNotification();var e=this,o=a(t.currentTarget),n=parseFloat(o.val()),i=parseFloat(o.attr("step")),r=parseFloat(o.attr("min")),s=parseFloat(o.attr("max")),c=!1,u=!1;if(isNaN(n)||n<0||n<r?c=!0:n>s?(c=!0,u=xoo_wsc_params.strings.maxQtyError.replace("%s%",s)):n%i!=0&&(c=!0,u=xoo_wsc_params.strings.stepQtyError.replace("%s%",i)),c)return o.val(this.baseQty),void(u&&(this.notice.add(u,"error"),this.notice.showNotification()));o.val(n),clearTimeout(this.qtyUpdateDelay),this.qtyUpdateDelay=setTimeout((function(){e.updateItemQty(o.parents(".xoo-wsc-product").data("key"),n)}),xoo_wsc_params.qtyUpdateDelay)}},{key:"updateItemQty",value:function(t,e){if(t&&void 0!==e){this.block();var o={cart_key:t,qty:e};a.ajax({url:l("xoo_wsc_update_item_quantity"),type:"POST",context:this,data:this.setAjaxData(o),success:function(t){this.updateFragments(t),a(document.body).trigger("xoo_wsc_quantity_updated",[t]),a(document.body).trigger("xoo_wsc_cart_updated",[t]),this.unblock()}})}}},{key:"closeCartOnClick",value:function(t){t.preventDefault(),this.toggle("hide")}},{key:"saveQtyFocus",value:function(t){this.baseQty=a(t.currentTarget).val()}},{key:"onPageShow",value:function(t){t.originalEvent.persisted&&(this.refreshMyFragments(),a(document.body).trigger("wc_fragment_refresh"))}},{key:"deleteIconClick",value:function(t){this.updateItemQty(a(t.currentTarget).parents(".xoo-wsc-product").data("key"),0)}},{key:"undoItem",value:function(t){var e={cart_key:a(t.currentTarget).data("key")};this.block(),a.ajax({url:l("xoo_wsc_undo_item"),type:"POST",context:this,data:this.setAjaxData(e),success:function(t){this.updateFragments(t),a(document.body).trigger("xoo_wsc_item_restored",[t]),a(document.body).trigger("xoo_wsc_cart_updated",[t]),this.unblock()}})}},{key:"storeShippingBarWidth",value:function(t){var e=a(document.body).find(".xoo-wsc-sb-bar > span");e.length&&(this.shippingBarWidth=e.prop("style").width)}},{key:"onCartUpdate",value:function(){o(e(h.prototype),"onCartUpdate",this).call(this),this.animateShippingBar(),this.initSlider(),this.showBasket()}},{key:"showBasket",value:function(){var t=a(".xoo-wsc-basket"),e=xoo_wsc_params.showBasket;"always_show"===e||"hide_empty"===e&&this.$modal.find(".xoo-wsc-product").length?t.show():t.hide()}},{key:"animateShippingBar",value:function(){if(!s&&!c){var t=a(document.body).find(".xoo-wsc-sb-bar > span");if(t.length&&this.shippingBarWidth){var e=t.prop("style").width;t.width(this.shippingBarWidth).animate({width:e},400,"linear")}}}},{key:"initSlider",value:function(){a.isFunction(a.fn.lightSlider)&&a("ul.xoo-wsc-sp-slider").lightSlider({item:1})}}]),h}(p),m=function(i){n(h,i);var s=d(h);function h(e){var o;return r(this,h),o=s.call(this,e,"slider"),xoo_wsc_params.sliderAutoClose&&(o.noticeSection="cart"),o.eventHandlers(),o.shipping=xoo_wsc_params.shippingEnabled?g.init(t(o)):null,o}return u(h,[{key:"eventHandlers",value:function(){o(e(h.prototype),"eventHandlers",this).call(this),a(document.body).on("click",".xoo-wsc-toggle-slider",this.triggerSlider.bind(this)),a(document.body).on("xoo_wsc_cart_toggled",this.closeSliderOnCartClose.bind(this)),xoo_wsc_params.sliderAutoClose&&a(document.body).on("xoo_wsc_coupon_applied xoo_wsc_shipping_calculated updated_shipping_method xoo_wsc_coupon_removed",this.closeSlider.bind(this)),this.$modal.on("submit","form.xoo-wsc-sl-apply-coupon",this.submitCouponForm.bind(this)),this.$modal.on("click",".xoo-wsc-coupon-apply-btn",this.applyCouponFromBtn.bind(this)),a(document.body).on("click",".xoo-wsc-remove-coupon",this.removeCoupon.bind(this))}},{key:"removeCoupon",value:function(t){t.preventDefault();var e=a(t.currentTarget),o={coupon:e.data("code")};this.block(),a.ajax({url:l("xoo_wsc_remove_coupon"),type:"POST",context:this,data:this.setAjaxData(o,y.$modal.find(e).length?"cart":"slider"),success:function(t){this.updateFragments(t)},complete:function(){this.unblock(),this.updateCartCheckoutPage(),a(document.body).trigger("xoo_wsc_coupon_removed")}})}},{key:"onCartUpdate",value:function(){o(e(h.prototype),"onCartUpdate",this).call(this),this.toggleContent()}},{key:"closeSlider",value:function(){this.toggle("hide")}},{key:"applyCouponFromBtn",value:function(t){this.applyCoupon(a(t.currentTarget).val())}},{key:"submitCouponForm",value:function(t){t.preventDefault();var e=a(t.currentTarget);this.applyCoupon(e.find('input[name="xoo-wsc-slcf-input"]').val())}},{key:"closeSliderOnCartClose",value:function(t){a(t.currentTarget);y.$modal.hasClass("xoo-wsc-cart-active")||this.toggle("hide")}},{key:"triggerSlider",value:function(t){var e=a(t.currentTarget).data("slider");if("shipping"===e&&c)return this.notice.add(xoo_wsc_params.strings.calculateCheckout,"error"),void this.notice.showNotification();this.$modal.attr("data-slider",e),this.toggle(),this.toggleContent()}},{key:"toggleContent",value:function(){a(".xoo-wsc-sl-content").hide();var t=this.$modal.attr("data-slider"),e=a('.xoo-wsc-sl-content[data-slider="'+t+'"]');e.length&&e.show(),a(document.body).trigger("xoo_wsc_slider_data_toggled",[t])}},{key:"applyCoupon",value:function(t){if(!t)return this.notice.add(xoo_wsc_params.strings.couponEmpty,"error"),void this.notice.showNotification();this.block();a.ajax({url:l("xoo_wsc_apply_coupon"),type:"POST",context:this,data:this.setAjaxData({action:"xoo_wsc_apply_coupon"}),success:function(t){this.updateFragments(t)},complete:function(){this.unblock(),this.updateCartCheckoutPage(),a(document.body).trigger("xoo_wsc_coupon_applied")}})}}]),h}(p),g={init:function(t){t.$modal.on("change","input.xoo-wsc-shipping-method",this.shippingMethodChange),t.$modal.on("submit","form.woocommerce-shipping-calculator",this.shippingCalculatorSubmit),t.$modal.on("click",".shipping-calculator-button",this.toggleCalculator),a(document.body).on("wc_fragments_refreshed wc_fragments_loaded xoo_wsc_slider_data_toggled",this.initSelect2)},toggleCalculator:function(t){t.preventDefault(),t.stopImmediatePropagation(),a(this).siblings(".shipping-calculator-form").slideToggle(),a(document.body).trigger("country_to_state_changed")},shippingCalculatorSubmit:function(t){t.preventDefault(),t.stopImmediatePropagation();var e=a(this);_.block(),a("<input />").attr("type","hidden").attr("name","calc_shipping").attr("value","x").appendTo(e);var o=e.serialize();a.ajax({url:l("xoo_wsc_calculate_shipping"),type:"POST",context:this,data:_.setAjaxData(o),success:function(t){_.updateFragments(t)},complete:function(){_.unblock(),_.updateCartCheckoutPage(),a(document.body).trigger("xoo_wsc_shipping_calculated")}})},shippingMethodChange:function(t){t.preventDefault(),t.stopImmediatePropagation();var e={};_.block(),a("select.shipping_method, :input[name^=xoo-wsc-shipping_method][type=radio]:checked, :input[name^=shipping_method][type=hidden]").each((function(){e[a(this).data("index")]=a(this).val()}));var o={shipping_method:e};a.ajax({type:"POST",url:l("xoo_wsc_update_shipping_method"),data:_.setAjaxData(o),success:function(t){_.updateFragments(t)},complete:function(){_.unblock(),_.updateCartCheckoutPage(),a(document.body).trigger("updated_shipping_method")}})},initSelect2:function(t){a(document.body).trigger("country_to_state_changed")}},y=new f(a(".xoo-wsc-modal")),_=new m(a(".xoo-wsc-slider-modal"))}))})();
//# sourceMappingURL=xoo-wsc-main.js.map